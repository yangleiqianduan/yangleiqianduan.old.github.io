# Zola

> 前端基于 react 开发的 web 框架
> with ♥︎ by lianjia-fe

```
                  __
    .-----.-----.|  |.---.-.
    |-- __|  _  ||  ||  _  |
    |_____|_____||__||___._|

    with ♥︎ by lianjia-fe
```

## TOP API

### zola.api

> 提供接口调用的封装

```
const test = zola.api( api => {

  api.config = {
    base: '//zythum.lianjia.com:3000/',
    codeKey: 'code',
    dataKey: 'data',
    messageKey: 'msg',
    successCode: 100000
  }
  api('ajax', { uri: 'ajax', mode: 'cors', method: 'post' })
  api('jsonp', { uri: 'jsonp', jsonp: true })

})

// 开发环境配置
.set('development', api => {
  api.config.base = '//0.0.0.0:3000/'
})

// 测试环境配置
.set('testing', api => {
  api.config.base = '//0.0.0.0:3000/'
})

// ----

test.ajax({a: 1, b: 2}).then(...)

test. jsonp({a: 1, b: 2}).then(...)

```
使用时将具柄 import 过来，直接调用执行，返回值是个promise


### zola.router

> 封装，用于从配置生成 react-router elment

```

const routes = zola.router({
  history: 'browserHistory',
  routes: [
    { path: '/', component: System.import('pages/index') },
    { path: '*', component: System.import('pages/404') },
  ]
})

```
通过 System.import 可进行代码粉片加载，
如果无需分片，直接传入 react elemnt 即可


### zola.render

> 将 react-element 渲染到页面

```
zola.render(routes, '#root')
```
返回一个 primise，resolve 时机为渲染完毕


### zola.set ／ zola.get
> zola 本身的配置 读写

```
zola.set('env', process.env.NODE_ENV)
zola.get('env')
```

### zola.on ／ zola.off ／ zola.emit

> 全局的 观察者模式


### zola.Base

> page 的基类 和  module 的基类 的 基类

+ 提供 cancelable 方法

    可以穿入方法或者promise如: `cancelable(function)` `cancelable(promise)`,
    如果在执行 cancel 之后才执行穿入的回调的情况下， 回调将不再被调用，
    运用方式比如

    ```
    class Index extends Page {
      componentDidMount () {
        super.componentDidMount()
        this.cancelable(test.ajax({a: 1})).then(res => {
          this  .setState(...)
        })
        this.cancelable(test.jsonp({a: 1})).then(res => {
          this.setState(...)
        })

        setTimeout(this.cancelable(() => {
          this.setState(...)
        }), 5000)
      }

      render () {
        return <div>Demo</div>
      }
    }
    ```
    其中的 setState 如果在 这个页面 ummount 之后执行，会有报错，但是如果使用cancelable，
    因为默认在 componentWillUnmount 会执行 cancelAll, 所以将不会有问题。


+ 提供 cancel 方法
+ 提供 cancelAll 方法

+ 提供 setTimeout 方法
+ 提供 setTimeoutAsync 方法
+ 提供 setInterval 方法
+ 提供 subscribe (on, off, emit)

+ 提供 componentWillUnmount，执行 clearTimeout, cancelAll, subscribe.off()

### zola.Page

> page 的基类

+ 提供 context subscribe
+ 提供 context location (from react-router)

### zola.Module

> module 的基类

+ 接收 context subscribe
+ 接收 context location
