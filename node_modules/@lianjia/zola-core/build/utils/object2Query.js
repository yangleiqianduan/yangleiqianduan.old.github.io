'use strict';

// == utils ==
var objectForEach = require('./objectForEach');
/**
 * 将 object 转化成 query
 * @param  {Object}  object
 * @param  {Boolean} encode
 * @return {String}
 */
module.exports = function object2Query(object) {
  var encode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

  var array = [];
  objectForEach(object, function (value, key) {
    // 处理为空的情况
    if (value === undefined || value === null) value = '';
    // 转换成字符串
    value = '' + value;
    // 是否需要 uri 转译
    if (encode) value = encodeURIComponent(value);

    array.push({ key: key, value: value });
  });
  if (array.length === 0) return '';
  return array.sort(function (_ref, _ref2) {
    var value1 = _ref.value;
    var value2 = _ref2.value;
    return value1.localeCompare(value2);
  }).sort(function (_ref3, _ref4) {
    var key1 = _ref3.key;
    var key2 = _ref4.key;
    return key1.localeCompare(key2);
  }).map(function (_ref5) {
    var key = _ref5.key,
        value = _ref5.value;
    return key + '=' + value;
  }).join('&');
};